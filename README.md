### 系统依赖

Win11 

python 3.8.17



### 复现流程

依次运行train.sh和test.sh，若结果与比赛时结果不一致，请手动依次运行train.py和test.py。

train负责训练出模型并保存到user_data文件夹中；

test负责使用train中训练出的模型并将预测结果csv文件保存到prediction_result文件夹中。

### 算法介绍

考虑到结构化数据的特点以及抑制过拟合的需要，本次预测使用了catboost模型。

在train和test中，将train.csv和test.csv合并，形成整体dataframe，便于构建各种特征，在训练和预测时再使用对应的行。

由于在测试集中不包含PM2.5等数据，所以同样需要对这些数据做出预测。

各监测站数据具有相关性，故17个站点的数据一起输入模型进行训练和预测。

##### 数据处理和特征工程

对连续数据进行log1p平滑，减轻异常值影响，使数据更符合高斯分布；

在模型调试过程中发现Toluene列对预测有一定危害，所以舍弃了该列；

考虑到较远数据缺失较严重且对当前预测意义不大，所以舍弃了2019年9月前的数据；

通过周期检测，发现数据对于month和hour具有较强的周期性，从date中提取了month和hour时间特征；

将shift_features中的列向后移动24和48小时，作为基础特征，反映时间序列的历史信息；

在这些时移特征的基础上，构建了长短期均值特征和滑动窗口内max统计特征，用于反映时间序列的变化趋势；

各监测站之间的数据具有一定相关性，将部分站点同一时刻的数据取平均值作为特征；

对历史数据中同监测站同小时的数据取平均值作为特征，为了增加参与平均的数据量，减轻极端值影响，在该特征中使用了2019年9月前的数据。

##### 模型构建

在训练模型中，由于要预测的列较多，不仅有target，还要预测PM2.5等作为未来预测的特征，依次模型调参成本较高，所以主要使用自动早停保证模型效果，但这种方式丢失了验证集的数据，所以采用两次构建模型，第一次获得早停的迭代次数，第二次将第一次的训练集和验证集合并为训练集，使用第一次的迭代次数。

##### 预测

在预测过程中，一次预测未来24小时的数据，共预测30次，将该次预测的结果用于下一次的预测。

这种仅训练一次模型的方式相较于使用预测得到的数据多次训练模型，大幅降低了时间成本，并一定程度上防止了误差累积，预测结果也较好。





